#noolite
=======
Драйверы приёмника и передатчика системы «умного дома» nooLite (http://www.noo.com.by/sistema-noolite.html) под Linux.  
Основано на проектах https://github.com/ermolenkom/noolite и https://github.com/vvzvlad/noolite/

Изменения: 
* сборка проекта переведена под autoconf/automake
* nooliterx: добавлены опции командной строки (установка таймаута, выполняемая команда)
* nooliterx: в выполняемую команду можно передавать любое количество их имеющихся аргументов в любом порядке
* nooliterx: добавлен режим демона
* nooliterx: вся выдача переведена на английский
* nooliterx: код отформатирован в едином стиле
* nooliterx: простейший парсер конфигурационного файла (параметры timeout, command)
* nooliterx: несколько малосущественных фиксов
* nooliterxcfg: поправлено число каналов в справке ([0..8] → [0..64])
* noolitepc: упорядочены опции командной строки
* noolitepcd: демон, принимающий команды для передатчиков nooLite через UNIX-сокет
  
##Инструкция
Помимо обычного окружения для сборки ПО, устанавливаем библиотеку libusb-1.0 (нужна для работы с HID-устройством)

  `sudo apt-get install libusb-1.0-0 libusb-1.0-0-dev`
или
  `sudo yum install libusb1 libusb1-devel`

(конкретика зависит от дистрибутива)
  
Скачиваем исходники  
  `wget https://github.com/olegart/noolite/archive/master.zip`  
  `unzip master.zip`
  `cd noolite-master`  
  `./configure && make && make install`  
  

###Использование:

######noolitepc — драйвер передатчика (PC118, PC1116, PC1132).

  `noolitepc <command> <channel> [<level>|<RGB>]`
  
command — основная команда:  

--on - включить канал  
--off - выключить канал  
--sw - переключить канал (вкл → выкл, выкл → вкл)  
--set - установить уровень яркости в канале (для диммируемых блоков)  
--bind - привязать канал передатчика к силовому блоку  
--unbind - отвязать канал  
--load - загрузить настройки канала  
--save - сохранить настройки канала  
--stop - Stop changing level  
--color - установить цвет R[0..255] G[0..255] B[0..255]  
--color_roll - Rolling color  
--color_switch - Switch color  
--color_mode - Switch mode  
--mode_speed - Switch speed change color  
<channel> — номер канала, [1..8] для PC118, [1..16] для PC1116 или [1..32] для PC1132
<level> — уровень яркости [0..100] в команде --set  
<RGB> — цвет [0..255] [0..255] [0..255] в команде --color_set

Например:  
Установить яркость 33 % в канале 1:  
  `noolitepc --set 1 33`  

Выключить канал 5:  
  `noolitepc --off 5 `  

######noolitepcd — демон драйвера передатчика (PC118, PC1116, PC1132).

Нужен для того, чтобы отправлять команды на передатчик из-под непривилегированного
пользователя, а также автоматически вставлять таймаут (400 мс) между идущими подряд
командами, чтобы дать передатчику время их переварить. Слушает UNIX-сокет /tmp/noolitepcd.sock,
принимаемые через сокет команды точно такие же, как у noolitepc

  `noolitepcd [-d]`

-d - запустить в фоне, освободив консоль

###### nooliterx — драйвер приёмника (RX1164)  

  `nooliterx [-c command] [-t timeout] [-d] [-h]`

Параметры  
  -c command — команда, которую будет запускать драйвер при приходе сигнала от пульта (по умолчанию — вывод в консоль)  
  -t timeout — таймаут исполнения команды, в миллисекундах (по умолчанию 250)  
  -d — запустить драйвер в фоне, освободив консоль  
  -i — игнорировать опции в файле /etc/noolite.conf  
  -h — напечатать справку и выйти  

Если одна и та же опция есть в файле /etc/noolite.conf и в командной строке, приоритет имеет командная строка.

Примеры команд для опции -c:  
  `echo 'Status: %st Channel: %ch Command: %cm Data format: %df Data bytes: %d0 %d1 %d2 %d3'`  
Печатает в консоли в одну строчку сведения о пришедшем от пульта сигнале.  
  
  `wget http://localhost/noolight/?script=switchNooLitePress\&channel=%ch\&command=%cm`  
Передаёт скрипту на локальном веб-сервере номер канала и команды при приходе сигнала от пульта.  
  
Используемые в формировании команд переменные (подробное описание их смысла см в API RX1164 на http://www.noo.com.by/):  
  %st — статус адапрета  
  %ch — номер канала  
  %cm — номер команды  
  %df — формат данных  
  %d0...%d3 — четыре байта данных
  
Команду и таймаут также можно задать в конфигурационном файле /etc/noolite.conf:  
  `command = echo 'Status: %st Channel: %ch Command: %cm Data format: %df Data bytes: %d0 %d1 %d2 %d3'`  
  `timeout = 250`  
При наличии одного из параметров и в файле, и в командной строке приоритет имеет командная строка.  

Начиная с версии 0.7.0, после запуска nooliterx открывает сокет /tmp/nooliterx.sock, в который можно отправлять команды
от nooliterxcfg. Таким образом, можно конфигурировать приёмник и передатчик из веб-интерфейса, без участия консоли
и без необходимости останавливать на время конфигурирования nooliterx, чтобы освободить USB-порт приемника.

###### nooliterxcfg — конфигурация приёмника (RX1164)  

  `nooliterxcfg --<command> [channel]`

command может быть:  
  --clear - сбросить привязку канала 
  --clearall - сбросить привязку ВСЕХ каналов
  --bind - начать привязку канала
  --stop - принудительно закончить привязку канала
  --help — напечатать справку  
  
  Номер канала должен быть в диапазоне [1...64]

